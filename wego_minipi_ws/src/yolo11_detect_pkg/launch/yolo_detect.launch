<launch>
  <arg name="rknn_file" default="$(find yolo11_detect_pkg)/config/rknn/pi_soccer3_best-rk3588.rknn" />
  <arg name="yaml_file" default="$(find yolo11_detect_pkg)/config/rknn/metadata.yaml" />
  <arg name="output_topic" default="/yolo/detections" />
  <arg name="tracker_output_topic" default="/ball/state" />

  <!-- test 런치는 usb_cam 사용 -->
  <arg name="camera_topic" default="/usb_cam/image_raw" />
  <arg name="pixel_format" default="yuyv" />
  <arg name="run_image_view" default="true" />

  <node pkg="usb_cam" type="usb_cam_node" name="usb_cam" output="screen">
    <!-- 필요하면 장치/해상도/프레임 지정 -->
    <param name="video_device" value="/dev/video0" />
    <param name="pixel_format" value="$(arg pixel_format)" />
    <param name="image_width" value="640" />
    <param name="image_height" value="480" />
    <param name="framerate" value="30" />
  </node>

  <node pkg="image_view" type="image_view" name="image_view" output="screen" if="$(arg run_image_view)">
    <remap from="image" to="$(arg camera_topic)" />
  </node>

  <node pkg="yolo11_detect_pkg" type="yolo_send_topic_test.py" name="yolo_detector" output="screen">
    <!-- 문제가 되면 아래 env 줄은 주석 처리 -->
    <!-- <env name="ROS_PYTHON_LOG_CONFIG_FILE" value="$(env HOME)/.ros/py_logging_nolevel.ini"/> -->

    <param name="~rknn_path" value="$(arg rknn_file)" />
    <param name="~yaml_path" value="$(arg yaml_file)" />

    <!-- ★ 입력 토픽 하드코딩을 런치에서 교정 -->
    <remap from="/camera/color/image_raw" to="$(arg camera_topic)"/>

    <!-- ★ 출력 토픽도 실제 퍼블리셔 이름에 맞춰 리맵 -->
    <remap from="/YoloInfo" to="$(arg output_topic)" />
  </node>
</launch>
